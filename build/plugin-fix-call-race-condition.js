!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=5)}([function(t,e){t.exports=window.Twilio.Flex},function(t,e){t.exports=React},function(t,e,n){"use strict";var o,r,i,a=n(10),u="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function c(){i=!1}function l(t){if(t){if(t!==o){if(t.length!==u.length)throw new Error("Custom alphabet for shortid must be "+u.length+" unique characters. You submitted "+t.length+" characters: "+t);var e=t.split("").filter((function(t,e,n){return e!==n.lastIndexOf(t)}));if(e.length)throw new Error("Custom alphabet for shortid must be "+u.length+" unique characters. These characters were not unique: "+e.join(", "));o=t,c()}}else o!==u&&(o=u,c())}function s(){return i||(i=function(){o||l(u);for(var t,e=o.split(""),n=[],r=a.nextValue();e.length>0;)r=a.nextValue(),t=Math.floor(r*e.length),n.push(e.splice(t,1)[0]);return n.join("")}())}t.exports={get:function(){return o||u},characters:function(t){return l(t),o},seed:function(t){a.seed(t),r!==t&&(c(),r=t)},lookup:function(t){return s()[t]},shuffled:s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(6);e.loadPlugin=o.loadPlugin,e.FlexPlugin=o.FlexPlugin;var r=n(7);e.getAssetsUrl=r.getAssetsUrl,e.getRuntimeUrl=r.getRuntimeUrl;var i=n(8);e.loadJS=i.loadJS;var a=n(17);e.loadCSS=a.loadCSS},function(t,e,n){"use strict";t.exports=n(9)},function(t,e,n){t.exports=n(18)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t){this.name=t,console.log("loading "+this.name+" plugin")}}();e.FlexPlugin=o,e.loadPlugin=function(t){Twilio&&Twilio.Flex&&Twilio.Flex.Plugins?Twilio.Flex.Plugins.init(t):console.warn("This version of Flex does not appear to support plugins.")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getRuntimeUrl=function(){if(document&&document.currentScript){var t=document.currentScript;if("string"===typeof t.src){var e=t.src;return e.substr(0,e.lastIndexOf("/"))}}return""},e.getAssetsUrl=function(){return e.getRuntimeUrl()+"/assets"}},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(n(4));e.loadJS=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.forEach((function(t){var e=document.createElement("script");e.id="external-js-"+r.default.generate(),e.type="text/javascript",e.src=t,document.body.appendChild(e)}))}},function(t,e,n){"use strict";var o=n(2),r=n(11),i=n(15),a=n(16)||0;function u(){return r(a)}t.exports=u,t.exports.generate=u,t.exports.seed=function(e){return o.seed(e),t.exports},t.exports.worker=function(e){return a=e,t.exports},t.exports.characters=function(t){return void 0!==t&&o.characters(t),o.shuffled()},t.exports.isValid=i},function(t,e,n){"use strict";var o=1;t.exports={nextValue:function(){return(o=(9301*o+49297)%233280)/233280},seed:function(t){o=t}}},function(t,e,n){"use strict";var o,r,i=n(12),a=(n(2),1567752802062),u=7;t.exports=function(t){var e="",n=Math.floor(.001*(Date.now()-a));return n===r?o++:(o=0,r=n),e+=i(u),e+=i(t),o>0&&(e+=i(o)),e+=i(n)}},function(t,e,n){"use strict";var o=n(2),r=n(13),i=n(14);t.exports=function(t){for(var e,n=0,a="";!e;)a+=i(r,o.get(),1),e=t<Math.pow(16,n+1),n++;return a}},function(t,e,n){"use strict";var o,r="object"===typeof window&&(window.crypto||window.msCrypto);o=r&&r.getRandomValues?function(t){return r.getRandomValues(new Uint8Array(t))}:function(t){for(var e=[],n=0;n<t;n++)e.push(Math.floor(256*Math.random()));return e},t.exports=o},function(t,e){t.exports=function(t,e,n){var o=(2<<Math.log(e.length-1)/Math.LN2)-1,r=Math.ceil(1.6*o*n/e.length);n=+n;for(var i="";;)for(var a=t(r),u=0;u<r;u++){var c=a[u]&o;if(e[c]&&(i+=e[c]).length===n)return i}}},function(t,e,n){"use strict";var o=n(2);t.exports=function(t){return!(!t||"string"!==typeof t||t.length<6)&&!new RegExp("[^"+o.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(t)}},function(t,e,n){"use strict";t.exports=0},function(t,e,n){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=o(n(4));e.loadCSS=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.forEach((function(t){var e=document.createElement("link");e.id="external-css-"+r.default.generate(),e.rel="stylesheet",e.type="text/css",e.media="all",e.href=t,document.head.appendChild(e)}))}},function(t,e,n){"use strict";n.r(e);var o=n(3);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function a(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function u(t){return(u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t){return(c="function"===typeof Symbol&&"symbol"===u(Symbol.iterator)?function(t){return u(t)}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":u(t)})(t)}function l(t,e){return!e||"object"!==c(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}var d=n(1),h=n.n(d),g=n(0);function v(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function y(){var t=v(["\n    font-weight: bold;\n"]);return y=function(){return t},t}function b(){var t=v(["\n    display: flex;\n    align-items: center;\n"]);return b=function(){return t},t}var m=Object(g.styled)("div")(b()),x=Object(g.styled)("span")(y());function w(){var t=v(["\n    background: none;\n    font-size: 12px;\n    letter-spacing: 0;\n    height: auto;\n    padding: 0;\n    text-transform: uppercase;\n\n    &:hover {\n        background: none;\n        text-decoration: underline;\n    }\n"]);return w=function(){return t},t}function C(){var t=v(['\n    display: flex;\n    align-items: center;\n    padding: 0 12px;\n    position: relative;\n    &:before,\n    &:after {\n        height: 16px;\n        width: 1px;\n        position: absolute;\n        left: 0;\n        background: #000; // hardcoded the color here as we don\'t have notfication theme object. Will need to update it once we have it.\n        opacity: 0.2;\n    }\n    &:after {\n        left: auto;\n        right: 0;\n    }\n    & + &:before {\n        content: "";\n    }\n']);return C=function(){return t},t}function k(){var t=v(["\n    margin-left: auto;\n    display: flex;\n"]);return k=function(){return t},t}var O=Object(g.styled)("div")(k()),S=Object(g.styled)("div")(C()),P=Object(g.styled)(g.Button)(w()),_=function(t){function e(){var t,n;r(this,e);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(n=l(this,(t=s(e)).call.apply(t,[this].concat(i)))).handleHangupClick=function(){var t=n.props.onHangup;g.Notifications.dismissNotificationById(n.props.notificationId),t()},n}return p(e,t),a(e,[{key:"render",value:function(){return d.createElement(O,null,d.createElement(S,null,d.createElement(P,{type:"button",onClick:this.handleHangupClick},"Cancel task")))}}]),e}(d.PureComponent),j=function(t){function e(){return r(this,e),l(this,s(e).apply(this,arguments))}return p(e,t),a(e,[{key:"render",value:function(){var t=this.props.notificationContext.onHangup;return h.a.createElement(m,null,h.a.createElement("span",null,"Sorry, the system isn\u2019t responding. It looks like the caller has already hung up."," ",h.a.createElement(x,null,"To continue, cancel the pending task.")),h.a.createElement(_,{notificationId:this.props.notificationId,onHangup:t}))}}]),e}(h.a.PureComponent);j.defaultProps={notificationContext:{}};var T="FixCallRaceConditionPlugin",M=function(t){function e(){var t;return r(this,e),(t=l(this,s(e).call(this,T))).manager=void 0,t.notificationID="HANGUP_STUCK_CALL_NOTIFICATION",t.handleBeforeAcceptTask=function(e){var n=e.task;if(g.TaskHelper.isCallTask(n)){var o=t.getPhoneConnectionFromState();t.ifFlavorTwo(o)&&t.hangupCallAndLog(2,"before accepting task"),setTimeout((function(){var e=t.getPhoneConnectionFromState();t.ifFlavorOne(e,n)&&g.Notifications.showNotification(t.notificationID,{onHangup:function(){return t.hangupCall()}})}),5e3)}},t.handleMonitorCall=function(){var e=t.getPhoneConnectionFromState(),n=t.manager.store.getState().flex.worker.tasks,o=Array.from(n.values());t.ifFlavorTwo(e)&&!o.find((function(t){return g.TaskHelper.isCallTask(t)&&"accepted"===t.status}))&&t.hangupCallAndLog(2,"before monitor call")},t.hangupCallAndLog=function(t,e){g.Actions.invokeAction("HangupCall",{task:{}}),console.error("Voice call race condition detected - Scenario 1, flavour ".concat(t,". Hanging an invalid call down on ").concat(e,"."))},t.hangupCall=function(){g.Actions.invokeAction("HangupCall",{task:{}})},t}return p(e,t),a(e,[{key:"init",value:function(t,e){this.manager=e,this.registerNotification(),t.Actions.addListener("beforeAcceptTask",this.handleBeforeAcceptTask),t.Actions.addListener("beforeMonitorCall",this.handleMonitorCall)}},{key:"registerNotification",value:function(){g.Notifications.registerNotification({type:g.NotificationType.warning,id:this.notificationID,content:h.a.createElement(j,{notificationId:this.notificationID}),timeout:0})}},{key:"getPhoneConnectionFromState",value:function(){return this.manager.store.getState().flex.phone.connection}},{key:"ifFlavorOne",value:function(t,e){return t&&e&&"pending"===e.status&&"outbound"!==e.attributes.direction}},{key:"ifFlavorTwo",value:function(t){return t}}]),e}(o.FlexPlugin);o.loadPlugin(M)}]);
//# sourceMappingURL=plugin-fix-call-race-condition.js.map